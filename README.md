# Cell-Differentiation-Classifier
A machine learning workflow that takes RNA-seq data to assess the differentiation potential of a cell line.

## Repository Data Files
**data_to_download_metadata.tsv** - extensive information of the HipSci datasets.

**download_files_list_wget.txt** - file that may be used with wget to download the data.

**dataset_summary.tsv** - summary file of the datasets that includes differentiation scores.

## Repository Scripts
**cell_diff_class_map.def** - Definitions file to build a singularity container for QC/trimming/mapping of RNA-seq FASTQ files.

**create_classifier_datafile.py** - collates the Kallisto data into one file. The script also determines the log10(tmp + 1) value for each transcript. In addition, the script returns the mean and standard deviation log(tpm + 1) for each transcript.  To to compare transcript levels between different cell lines (or more accurately accessions), the script determines the z-score for each transcript (i.e. comparing the expression of a transcript in a given cell accession against that same transcript in different accessions.)

**logistic_regression_classifier.ipynb** - Jupyter notebook that runs the logistic regression classifier.  Takes as input the data file generated by create_classifier_datafile.py script.

**map_fastq_file.sh** - Bash script for QC/trimming/mapping of RNA-seq FASTQ files.  The script processes all files with extension *.fastq.gz in the current working directory.  The Kallisto transcriptome reference file should be passed as an argument.

    map_fastq_file.sh [Kallisto transcriptome reference file] 


## Workflow overview
To improve consistency between samples (and any future samples), map only the forward read of paired-end data or use single-end data.  This is because unknown future samples may be single-end, and if we have mapped against paired-end data to build our classification model, then this could lead to inaccurate results. Below give more detail on the QC, trimming and mapping processes.

### QC
Quality control is performed with FastQC v0.11.9 and MultiQC v1.11QC.

### Trimming
Uses TrimGalore! version 0.6.3, powered by Cutadapt version 3.1.

Reads are trimmed with standard paramteres, and then re-trimmed while pre-trimming to 50nt reads (TrimGalore! parameter --hardtrim5 50)

### Mapping
Mapping uses Kallisto, version 0.46.1

    kallisto quant -i [Kallisto index] -o $F.kallisto --single -l 200 -s 20 -t 20 [FASTQ FILE] 

The Homo sapiens GRCh38 (v102) cDNA genome was downloaded from [Ensembl](http://www.ensembl.org/) to make the Kallisto index.

## Processing data
We recommend using the Singularity container for QC/trimming/mapping.  Run the command below to build the container using the definitions file.  (The --bind $PWD:/mnt argument makes your current working directory ($PWD) visible to the container (/mnt folder)).  

    sudo singularity build --bind $PWD:/mnt cell_diff_class_map.sif cell_diff_class_map.def

The command below start the QC/trimming/mapping
    singularity run --bind $PWD:/mnt cell_diff_class_map.sif [Kallisto index]

**Note:** All the FASTQ files for processing and the Kallisto index should be in your current working directory.  FASTQ files with the extenstion *.fastq.gz will be processed.

Should you wish to enter the container (e.g. for using Kallisto to generate the Kaillisto transcriptome index), run the command:

    singularity shell --bind $PWD:/mnt cell_diff_class_map.sif

Steven Wingett, The MRC-Laboratory of Molecular Biology, Cambridge, UK